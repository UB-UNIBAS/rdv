<!-- Trefferlisten (Suche und Merkliste) als Tabs (Pills) -->
<div class="d-flex flex-column p-2 col-md mt-2 mb-2"
     style="border: 1px solid grey; border-radius:3px;" [formGroup]="parentFormGroup">

  <!-- DIV-Container fuer Tab-Links -->
  <nav class="nav nav-pills "
       id="result-pills-tab"
       role="tablist">

    <!-- Tab-Link fuer Trefferliste -->
    <a class="btn btn-outline-primary mr-2 text-sm-center px-2 py-1 active"
       id="results-pills-search-tab"
       data-toggle="pill"
       href="#results-pills-search"
       role="tab"
       aria-controls="pills-search"
       aria-expanded="true">Ergebnisse
      <!-- Treffer-Anzahl in Trefferliste -->
      <strong>({{count}})</strong>
    </a>

    <!-- Tab-Link fuer Merkliste -->
    <a class="btn btn-outline-primary text-sm-center px-2 py-1"
       id="results-pills-basket-tab"
       data-toggle="pill"
       href="#results-pills-basket"
       role="tab"
       aria-controls="pills-basket"
       aria-expanded="true">Merkliste
      <!-- Treffer-Anzahl in Merkliste -->
      <strong>({{numberOfBaskets$ | async}})</strong>
    </a>
  </nav>

  <!-- DIV-Container fuer Tab-Inhalte (Trefferliste + Merkliste) -->
  <div class="tab-content"
       id="result-pills-tabContent">

    <!-- DIV fuer Trefferlisten-Tab -->
    <div class="tab-pane list-group active"
         id="results-pills-search"
         role="tabpanel"
         aria-labelledby="facet-pills-search-tab">

      <!-- Zeile aus Treffer-Anzahl, Select Treffer pro Seite, Pagination der Treffertabelle -->
      <div class="d-flex justify-content-start flex-wrap">

        <!-- Block: Select Treffer pro Seite + Pagination -->
        <div *ngIf="count"
             class="d-flex flex-wrap align-items-center justify-content-between justify-content-md-end flex-auto">

          <!-- Link fuer export -->
          <a *ngIf="showExportListTable"
             class="btn btn-outline-primary text-sm-center px-2 py-1 mr-2"
             [href]="exportListData"
             (click)="exportList(docs)"
             download="export-trefferliste.txt"><i class="fa fa-download"></i> Liste Exportieren</a>

          <!-- Select Treffer pro Seite -->
          <div class="form-inline mr-2 mb-2 mb-md-0">

            <!-- Select: Rows -->
            <select class="form-control form-control-sm"
                    formControlName="rows" id="rows">
              <option *ngFor="let rowOpt of mainConfig.rowOpts"
                      [value]="rowOpt">{{rowOpt}}
              </option>
            </select>

            <!-- Label: Treffer pro Seite -->
            <label class="form-label ml-2 d-flex justify-content-center"
                   for="rows">Treffer pro Seite</label>
          </div>

          <!-- Paging fuer Treffertabelle -->
          <div class="btn-group btn-group-sm mb-2 mb-md-0"
               role="group"
               aria-label="Small button group">

            <!-- 1. Seite -->
            <button class="btn btn-primary fa fa-angle-double-left"
                    (click)="setSearchOffset('first')"
                    [disabled]="query.queryParams.start == 0">
            </button>

            <!-- nach links blaettern -->
            <button class="btn btn-primary fa fa-angle-left"
                    (click)="setSearchOffset(-1)"
                    [disabled]="query.queryParams.start == 0">
            </button>

            <!-- aktuelle Seite von insgesamt x Seiten -->
            <div class="row-count">{{ page}} / {{pages}}</div>

            <!-- nach rechts blaettern -->
            <button class="btn btn-primary fa fa-angle-right"
                    (click)="setSearchOffset(1)"
                    [disabled]="page == pages"></button>

            <!-- letztes Seite -->
            <button class="btn btn-primary fa fa-angle-double-right"
                    (click)="setSearchOffset('last')"
                    [disabled]="page == pages"></button>
          </div>
        </div>
      </div>

      <!-- Treffertabelle -->
      <div *ngIf="count"
           class="mt-2 mh-table-view">

        <!-- Tabellenheader -->
        <div class="d-flex mh-table-header font-weight-bold">

          <!-- Ueber Spaltenfelder gehen -->
          <ng-container *ngFor="let field of tableFields; index as index">

            <!-- Wenn es ein sortierbares Feld ist, Sortierfunktionen setzen -->
            <div *ngIf="field.sort"
                 (click)="sortSearchTable(field.sort)"
                 [class]="field.css + ' text-center'"
                 [class.mh-sort-by-column]="index === sortColumnSearch">{{field.label}}

              <!-- Sortiersymbol -->
              <span [class]="'mh-sort fa ' + getSortBySymbol(field.sort)"></span>
            </div>

            <!-- Wenn es kein sortierbares Feld ist, nur Ueberschrift ausgeben -->
            <div *ngIf="!field.sort"
                 [class]="'text-center ' + field.css">{{field.label}}
            </div>
          </ng-container>

          <!-- Letzte Spalte fuer Merkliste -->
          <div class="col-1 text-center">

            <!-- Star als icon -->
            <span class="fa fa-star"></span>
          </div>
        </div>

        <!-- Tabellenzeilen -->
        <div class="mh-table-row d-flex flex-column"
             *ngFor="let doc of docs">

          <!-- 1. Zeile mit Hauptinfos -->
          <div class="d-flex flex-column flex-sm-row mh-table-row-main no-gutters">

            <!-- Ueber Spaltenfelder gehen -->
            <ng-container *ngFor="let field of tableFields; first as first; index as index">

              <!-- Spalte -->
              <div [class]="field.css + ' d-flex no-gutters py-1 px-2'"
                   [class.mh-sort-by-column]="index === sortColumnSearch">

                <!-- Label ("Titel: "") nur bei kleinster Darstellung (vertikal) anzeigen -->
                <label class="d-sm-none font-weight-bold text-right mr-2">{{field.label}}</label>

                <!-- Wenn kein Wert gesetzt ist -->
                <span *ngIf="getType(doc[field.field]) === 'unset'"
                      class="col"
                      [class.mh-flex-1]="first">
                      <i>ohne</i>
                    </span>

                <!-- Wenn es ein Einzelwert ist (z.B. ID, Jahr,...), einfach Wert ausgeben -->
                <span *ngIf="getType(doc[field.field]) === 'single'"
                      class="col"
                      [class.mh-flex-1]="first">{{doc[field.field]}}</span>

                <!-- Wenn es ein Multiwert ist (z.B. Personen, Schlagwoerter,...), Werte aggregiert ausgeben -->
                <span *ngIf="getType(doc[field.field]) === 'multi'"
                      class="col">

                      <!-- Ueber Werte (z.B. einzelne Personen) gehen -->
                      <ng-container *ngFor="let singleValue of doc[field.field], last as last">

                        <!-- Wert ausgeben -->
                        {{singleValue}}

                        <!-- Wenn es nicht der letzte Wert war ein <br> einfuegen -->
                        <br *ngIf="!last">
                      </ng-container>
                    </span>

                <!-- ggfs. einen Link auf Landing Page -->
                <a *ngIf="field.landingpage === true"
                   class="d-none d-sm-block btn btn-sm btn-primary fa fa-info p-1 mb-1"
                   [routerLink]="['/doc', doc.id]"></a>

                <!-- ggfs. einen Button zum Einblenden der zusaetzlichen Infos, erst ab sm sichtbar sichtbar -->
                <button *ngIf="field.extraInfo === true"
                        class="d-none d-sm-block btn btn-sm btn-primary fa p-1"
                        [class.fa-arrow-down]="!detailDataArray[doc.id]?.visible"
                        [class.fa-arrow-up]="detailDataArray[doc.id]?.visible"
                        (click)="getFullData(doc.id)"></button>
              </div>
            </ng-container>

            <!-- letzte Spalte fuer Merkliste, Klick Event auf ganze Zelle: "Merken" fuegt ID ein oder loescht sie aus aktiver Merkliste -->
            <div class="col-sm-1 d-flex align-items-center no-gutters py-1 px-2"
                 (click)="addOrRemoveRecordInBasket(doc.id)">

              <!-- Label "Merken" nur bei kleinster Darstellung (vertikal) anzeigen -->
              <label class="d-sm-none font-weight-bold text-right mr-2">Add</label>

              <!-- Star-Symbol  -->
              <div class="col text-sm-center">
                    <span class="fa"
                          [ngClass]="(currentBasket$ | async).ids.includes(doc.id) ?
                          'fa-star-o text-warning' :
                          'text-warning fa-star'">
                    </span>
              </div>
            </div>
          </div>

          <!-- Link auf Landing Page und Button zum Einblenden der zusaetzlichen Infos, nur bei schmalster Breite sichtbar -->
          <div
            *ngIf="tableFieldsDisplayLandingpage || tableFieldsDisplayExtraInfo"
            class="d-flex d-sm-none" style="margin:auto">
            <!-- Link auf Landing Page -->
            <a *ngIf="tableFieldsDisplayLandingpage"
               class="btn btn-primary btn-sm p-1 fa fa-info mb-1"
               [routerLink]="['/doc', doc.id]"></a>

            <!-- Button zum Einblenden der zusaetzlichen Infos -->
            <button *ngIf="tableFieldsDisplayExtraInfo"
                    class="btn btn-primary btn-sm p-1 fa mb-1 ml-2"
                    [class.fa-arrow-down]="!detailDataArray[doc.id]?.visible"
                    [class.fa-arrow-up]="detailDataArray[doc.id]?.visible"
                    (click)="getFullData(doc.id)">
            </button>
          </div>

          <!-- Zusatzzeile mit Details anzeigen, wenn sichtbar -->
          <div class="mh-table-row-info no-gutters"
               *ngIf="detailDataArray[doc.id]?.visible">

            <!-- Ueber Felder der Config gehen -->
            <ng-container *ngFor="let key of extraInfos | objectKeys">

              <!-- 1 grosse Zelle fuer Inhalt, anzeigen, wenn es Daten zu diesem Feld gibt -->
              <div class="col-12 d-flex no-gutters"
                   *ngIf="detailDataArray[doc.id]?.data[extraInfos[key].field]?.length">

                <!-- Ueberschrift links (z.B. "Schlagwoerter") -->
                <label class="font-weight-bold text-right mr-2">{{extraInfos[key].label}}</label>

                <!-- Wenn es ein Einzeltwert ist, Wert ausgeben und mit innerHTML binden, damit auch HTML (z.B. <a>) moeglich ist -->
                <span class="col"
                      *ngIf="getType(detailDataArray[doc.id]?.data[extraInfos[key].field]) === 'single'"
                      [innerHTML]="formatValue(detailDataArray[doc.id]?.data[extraInfos[key].field], extraInfos[key].display)">
                    </span>

                <!-- Wenn es ein Multiwert ist -->
                <span class="col"
                      *ngIf="getType(detailDataArray[doc.id]?.data[extraInfos[key].field]) === 'multi'">

                      <!-- Ueber Werte (z.B. einzelne Schlagwoerter) gehen -->
                      <ng-container
                        *ngFor="let value of detailDataArray[doc.id]?.data[extraInfos[key].field]; last as isLast;">

                        <!-- Wert ausgeben, mit innerHTML binden, damit auch HTML (z.B. <a>) moeglich ist -->
                        <span [innerHTML]="formatValue(value, extraInfos[key].display)"></span>

                        <!-- Zeilenumbruch, wenn nicht der letzte Wert -->
                        <br *ngIf="!isLast">
                      </ng-container>
                    </span>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- DIV fuer Merklisten-Tab -->
    <div class="tab-pane list-group"
         id="results-pills-basket"
         role="tabpanel"
         aria-labelledby="facet-pills-basket-tab">

      <!-- Zeile aus Treffer-Anzahl und Pagination der Merkliste -->
      <div class="d-flex justify-content-start flex-wrap">

        <!-- Block: Pagination fuer Merlisten-Treffertabelle (keine Auswahlmoeglichkeit wie viele Treffer pro Seite) -->
        <div *ngIf="numberOfBaskets$ | async"
             class="d-flex flex-wrap align-items-center justify-content-between justify-content-md-end flex-auto">

          <!-- Link fuer export -->
          <a *ngIf="showExportListBasket"
             class="btn btn-outline-primary text-sm-center px-2 py-1 mr-2"
             [href]="exportListData"
             (click)="exportList(basketDocs)"
             download="export-merkliste.txt"><i class="fa fa-download"></i> Liste Exportieren</a>

          <!-- Paging fuer Merklisten-Treffertabelle -->
          <div class="btn-group btn-group-sm mb-2 mb-md-0"
               role="group"
               aria-label="Small button group">

            <!-- 1. Seite -->
            <button class="btn btn-primary fa fa-angle-double-left"
                    (click)="setBasketOffset('first')"
                    [disabled]="basketPage == 1">
            </button>

            <!-- nach links blaettern -->
            <button class="btn btn-primary fa fa-angle-left"
                    (click)="setBasketOffset(-1)"
                    [disabled]="basketPage == 1">
            </button>

            <!-- aktuelle Seite von insgesamt x Seiten -->
            <div class="row-count">{{ basketPage}} / {{basketPages}}</div>

            <!-- nach rechts blaettern -->
            <button class="btn btn-primary fa fa-angle-right"
                    (click)="setBasketOffset(1)"
                    [disabled]="basketPage == basketPages"></button>

            <!-- letztes Seite -->
            <button class="btn btn-primary fa fa-angle-double-right"
                    (click)="setBasketOffset('last')"
                    [disabled]="basketPage == basketPages"></button>
          </div>
        </div>
      </div>

      <!-- Merklisten-Treffertabelle -->
      <div *ngIf="numberOfBaskets$ | async"
           class="mt-2 mh-table-view">

        <!-- Tabellenheader -->
        <div class="d-flex mh-table-header font-weight-bold">

          <!-- Ueber Spaltenfelder gehen -->
          <ng-container *ngFor="let field of tableFields; index as index">

            <!-- Wenn es ein sortierbares Feld ist, Sortierfunktionen setzen -->
            <div *ngIf="field.sort"
                 (click)="sortBasketTable(field.sort)"
                 [class]="field.css + ' text-center'"
                 [class.mh-sort-by-column]="index === sortColumnBasket">{{field.label}}

              <!-- Sortiersymbol -->
              <span [class]="'mh-sort fa ' +
              (currentBasket$ | async).queryParams.sortField === field.sort ?
              (currentBasket$ | async).queryParams.sortDir === 'asc' ? 'fa-sort-asc' : 'fa-sort-desc' :
              'fa-sort'">
              </span>
            </div>

            <!-- Wenn es kein sortierbares Feld ist, nur Ueberschrift ausgeben -->
            <div *ngIf="!field.sort"
                 [class]="'text-center ' + field.css">{{field.label}}
            </div>
          </ng-container>

          <!-- Letzte Spalte fuer Merkliste -->
          <div class="col-1 text-center">

            <!-- Star als icon -->
            <span class="fa fa-star"></span>
          </div>
        </div>

        <!-- Tabellenzeilen -->
        <div class="mh-table-row d-flex flex-column"
             *ngFor="let doc of basketDocs">

          <!-- 1. Zeile mit Hauptinfos -->
          <div class="d-flex flex-column flex-sm-row mh-table-row-main no-gutters">

            <!-- Ueber Spaltenfelder gehen -->
            <ng-container *ngFor="let field of tableFields; first as first; index as index">

              <!-- Spalte -->
              <div [class]="field.css + ' d-flex no-gutters py-1 px-2'"
                   [class.mh-sort-by-column]="index === sortColumnBasket">

                <!-- Label ("Titel: "") nur bei kleinster Darstellung (vertikal) anzeigen -->
                <label class="d-sm-none font-weight-bold text-right mr-2">{{field.label}}</label>

                <!-- Wenn kein Wert gesetzt ist -->
                <span *ngIf="getType(doc[field.field]) === 'unset'"
                      class="col"
                      [class.mh-flex-1]="first">
                      <i>ohne</i>
                    </span>

                <!-- Wenn es ein Einzelwert ist (z.B. ID, Jahr,...), einfach Wert ausgeben -->
                <span *ngIf="getType(doc[field.field]) === 'single'"
                      class="col"
                      [class.mh-flex-1]="first">{{doc[field.field]}}</span>

                <!-- Wenn es ein Multiwert ist (z.B. Personen, Schlagwoerter,...), Werte aggregiert ausgeben -->
                <span *ngIf="getType(doc[field.field]) === 'multi'"
                      class="col">

                      <!-- Ueber Werte (z.B. einzelne Personen) gehen -->
                      <ng-container *ngFor="let singleValue of doc[field.field], last as last">

                        <!-- Wert ausgeben -->
                        {{singleValue}}

                        <!-- Wenn es nicht der letzte Wert war ein <br> einfuegen -->
                        <br *ngIf="!last">
                      </ng-container>
                    </span>

                <!-- ggfs. einen Link auf Landing Page -->
                <a *ngIf="field.landingpage === true"
                   class="d-none d-sm-block btn btn-sm btn-primary fa fa-info p-1 mb-1"
                   [routerLink]="['/doc', doc.id]"></a>

                <!-- ggfs. einen Button zum Einblenden der zusaetzlichen Infos, erst ab sm sichtbar sichtbar -->
                <button *ngIf="field.extraInfo === true"
                        class="d-none d-sm-block btn btn-sm btn-primary fa p-1"
                        [class.fa-arrow-down]="!detailDataArray[doc.id]?.visible"
                        [class.fa-arrow-up]="detailDataArray[doc.id]?.visible"
                        (click)="getFullData(doc.id)"></button>
              </div>
            </ng-container>

            <!-- letzte Spalte fuer Merkliste, Klick-Event auf die ganze Zeile -->
            <div class="col-sm-1 d-flex align-items-center no-gutters py-1 px-2"
                 (click)="addOrRemoveRecordInBasket(doc.id)">

              <!-- Label "Merken" nur bei kleinster Darstellung (vertikal) anzeigen -->
              <label class="d-sm-none font-weight-bold text-right mr-2">Add</label>

              <!-- Button "Merken" fuegt ID ein oder loescht sie aus aktiver Merkliste -->
              <div class="col text-sm-center">

                <!-- Bei Merkliste imm ein ausgefuellten Stern anzeigen -->
                <span class="text-warning fa fa-star"></span>
              </div>
            </div>
          </div>

          <!-- Link auf Landing Page und Button zum Einblenden der zusaetzlichen Infos, nur bei schmalster Breite sichtbar -->
          <div
            *ngIf="tableFieldsDisplayLandingpage || tableFieldsDisplayExtraInfo"
            class="d-flex d-sm-none" style="margin:auto">
            <!-- Link auf Landing Page -->
            <a *ngIf="tableFieldsDisplayLandingpage"
               class="btn btn-primary btn-sm p-1 fa fa-info mb-1"
               [routerLink]="['/doc', doc.id]"></a>

            <!-- Button zum Einblenden der zusaetzlichen Infos -->
            <button *ngIf="tableFieldsDisplayExtraInfo"
                    class="btn btn-primary btn-sm p-1 fa mb-1 ml-2"
                    [class.fa-arrow-down]="!detailDataArray[doc.id]?.visible"
                    [class.fa-arrow-up]="detailDataArray[doc.id]?.visible"
                    (click)="getFullData(doc.id)">
            </button>
          </div>

          <!-- Zusatzzeile mit Details anzeigen, wenn sichtbar -->
          <div class="mh-table-row-info no-gutters p-2"
               *ngIf="detailDataArray[doc.id]?.visible">

            <!-- Ueber Felder der Config gehen -->
            <ng-container *ngFor="let key of extraInfos | objectKeys">

              <!-- 1 grosse Zelle fuer Inhalt, anzeigen, wenn es Daten zu diesem Feld gibt -->
              <div class="col-12 d-flex no-gutters"
                   *ngIf="detailDataArray[doc.id]?.data[extraInfos[key].field]?.length">

                <!-- Ueberschrift links (z.B. "Schlagwoerter") -->
                <label class="font-weight-bold text-right mr-2">{{extraInfos[key].label}}</label>

                <!-- Wenn es ein Einzeltwert ist, Wert ausgeben und mit innerHTML binden, damit auch HTML (z.B. <a>) moeglich ist -->
                <span class="col"
                      *ngIf="getType(detailDataArray[doc.id]?.data[extraInfos[key].field]) === 'single'"
                      [innerHTML]="formatValue(detailDataArray[doc.id]?.data[extraInfos[key].field], extraInfos[key].display)">
                    </span>

                <!-- Wenn es ein Multiwert ist -->
                <span class="col"
                      *ngIf="getType(detailDataArray[doc.id]?.data[extraInfos[key].field]) === 'multi'">

                      <!-- Ueber Werte (z.B. einzelne Schlagwoerter) gehen -->
                      <ng-container
                        *ngFor="let value of detailDataArray[doc.id]?.data[extraInfos[key].field]; last as isLast">

                        <!-- Wert ausgeben, mit innerHTML binden, damit auch HTML (z.B. <a>) moeglich ist -->
                        <span [innerHTML]="formatValue(value, extraInfos[key].display)"></span>

                        <!-- Zeilenumbruch, wenn nicht der letzte Wert -->
                        <br *ngIf="!isLast">
                      </ng-container>
                    </span>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>

