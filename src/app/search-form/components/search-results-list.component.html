<div class="tab-pane list-group active"
     id="results-pills-search"
     role="tabpanel"
     aria-labelledby="facet-pills-search-tab">

  <!-- Zeile aus Treffer-Anzahl, Select Treffer pro Seite, Pagination der Treffertabelle -->
  <div class="d-flex justify-content-start flex-wrap">

    <!-- Block: Select Treffer pro Seite + Pagination -->
    <div *ngIf="count$ | async"
         class="d-flex flex-wrap align-items-center justify-content-between justify-content-md-end flex-auto">

      <app-export-results-list *ngIf="showExportList"></app-export-results-list>

      <!-- Select Treffer pro Seite -->
      <div class="form-inline mr-2 mb-2 mb-md-0">

        <!-- Select: Rows -->
        <select class="form-control form-control-sm" id="rows">
          <option *ngFor="let rowOpt of rowOpts"
                  [value]="rowOpt">{{rowOpt}}
          </option>
        </select>

        <!-- Label: Treffer pro Seite -->
        <label class="form-label ml-2 d-flex justify-content-center"
               for="rows">Treffer pro Seite</label>
      </div>

      <!-- Paging fuer Treffertabelle -->
      <div class="btn-group btn-group-sm mb-2 mb-md-0"
           role="group"
           aria-label="Small button group">

        <!-- 1. Seite -->
        <button class="btn btn-primary fa fa-angle-double-left"
                (click)="setSearchOffset('first')"
                [disabled]="(offset$ | async) == 0">
        </button>

        <!-- nach links blaettern -->
        <button class="btn btn-primary fa fa-angle-left"
                (click)="setSearchOffset(-1)"
                [disabled]="(offset$ | async) == 0">
        </button>

        <!-- aktuelle Seite von insgesamt x Seiten -->
        <div class="row-count">{{ page}} / {{pages}}</div>

        <!-- nach rechts blaettern -->
        <button class="btn btn-primary fa fa-angle-right"
                (click)="setSearchOffset(1)"
                [disabled]="page == pages"></button>

        <!-- letztes Seite -->
        <button class="btn btn-primary fa fa-angle-double-right"
                (click)="setSearchOffset('last')"
                [disabled]="page == pages"></button>
      </div>
    </div>
  </div>

  <!-- Treffertabelle -->
  <div *ngIf="count$ | async"
       class="mt-2 mh-table-view">

    <!-- Tabellenheader -->
    <div class="d-flex mh-table-header font-weight-bold">

      <!-- Ueber Spaltenfelder gehen -->
      <ng-container *ngFor="let field of tableFields; index as index">

        <!-- Wenn es ein sortierbares Feld ist, Sortierfunktionen setzen -->
        <div *ngIf="field.sort"
             (click)="sortSearchTable(field.sort)"
             [class]="field.css + ' text-center'"
             [class.mh-sort-by-column]="index === sortColumn">{{field.label}}

          <!-- Sortiersymbol -->
          <span [class]="'mh-sort fa ' + getSortBySymbol(field.sort)"></span>
        </div>

        <!-- Wenn es kein sortierbares Feld ist, nur Ueberschrift ausgeben -->
        <div *ngIf="!field.sort"
             [class]="'text-center ' + field.css">{{field.label}}
        </div>
      </ng-container>

      <!-- Letzte Spalte fuer Merkliste -->
      <div class="col-1 text-center">

        <!-- Star als icon -->
        <span class="fa fa-star"></span>
      </div>
    </div>

    <!-- Tabellenzeilen -->
    <div class="mh-table-row d-flex flex-column"
         *ngFor="let doc of (docs$ | async)">

      <!-- 1. Zeile mit Hauptinfos -->
      <div class="d-flex flex-column flex-sm-row mh-table-row-main no-gutters">

        <!-- Ueber Spaltenfelder gehen -->
        <ng-container *ngFor="let field of tableFields; first as first; index as index">

          <!-- Spalte -->
          <div [class]="field.css + ' d-flex no-gutters py-1 px-2'"
               [class.mh-sort-by-column]="index === sortColumn">

            <!-- Label ("Titel: "") nur bei kleinster Darstellung (vertikal) anzeigen -->
            <label class="d-sm-none font-weight-bold text-right mr-2">{{field.label}}</label>

            <!-- Wenn kein Wert gesetzt ist -->
            <span *ngIf="getType(doc[field.field]) === 'unset'"
                  class="col"
                  [class.mh-flex-1]="first">
                      <i>ohne</i>
                    </span>

            <!-- Wenn es ein Einzelwert ist (z.B. ID, Jahr,...), einfach Wert ausgeben -->
            <span *ngIf="getType(doc[field.field]) === 'single'"
                  class="col"
                  [class.mh-flex-1]="first">{{doc[field.field]}}</span>

            <!-- Wenn es ein Multiwert ist (z.B. Personen, Schlagwoerter,...), Werte aggregiert ausgeben -->
            <span *ngIf="getType(doc[field.field]) === 'multi'"
                  class="col">

                      <!-- Ueber Werte (z.B. einzelne Personen) gehen -->
                      <ng-container *ngFor="let singleValue of doc[field.field], last as last">

                        <!-- Wert ausgeben -->
                        {{singleValue}}

                        <!-- Wenn es nicht der letzte Wert war ein <br> einfuegen -->
                        <br *ngIf="!last">
                      </ng-container>
                    </span>

            <!-- ggfs. einen Link auf Landing Page -->
            <a *ngIf="field.landingpage === true"
               class="d-none d-sm-block btn btn-sm btn-primary fa fa-info p-1 mb-1"
               [routerLink]="['/doc', doc.id]"></a>

            <!-- ggfs. einen Button zum Einblenden der zusaetzlichen Infos, erst ab sm sichtbar sichtbar -->
            <button *ngIf="field.extraInfo === true"
                    class="d-none d-sm-block btn btn-sm btn-primary fa p-1"
                    [class.fa-arrow-down]="!hasDetailedViewOpen(doc.id)"
                    [class.fa-arrow-up]="hasDetailedViewOpen(doc.id)"
                    (click)="getFullData(doc.id)"></button>
          </div>
        </ng-container>

        <app-basket-icon [basket]="currentBasket$ | async" [basketElement]="doc.id"></app-basket-icon>
      </div>

      <!-- Link auf Landing Page und Button zum Einblenden der zusaetzlichen Infos, nur bei schmalster Breite sichtbar -->
      <div
        *ngIf="tableFieldsDisplayLandingpage || tableFieldsDisplayExtraInfo"
        class="d-flex d-sm-none" style="margin:auto">
        <!-- Link auf Landing Page -->
        <a *ngIf="tableFieldsDisplayLandingpage"
           class="btn btn-primary btn-sm p-1 fa fa-info mb-1"
           [routerLink]="['/doc', doc.id]"></a>

        <!-- Button zum Einblenden der zusaetzlichen Infos -->
        <button *ngIf="tableFieldsDisplayExtraInfo"
                class="btn btn-primary btn-sm p-1 fa mb-1 ml-2"
                [class.fa-arrow-down]="!hasDetailedViewOpen(doc.id)"
                [class.fa-arrow-up]="hasDetailedViewOpen(doc.id)"
                (click)="getFullData(doc.id)">
        </button>
      </div>

      <!-- Zusatzzeile mit Details anzeigen, wenn sichtbar -->
      <div class="mh-table-row-info no-gutters"
           *ngIf="hasDetailedViewOpen(doc.id)">

        <!-- Ueber Felder der Config gehen -->
        <ng-container *ngFor="let key of extraInfos | objectKeys">

          <!-- 1 grosse Zelle fuer Inhalt, anzeigen, wenn es Daten zu diesem Feld gibt -->
          <div class="col-12 d-flex no-gutters"
               *ngIf="(detailedView$ | async)[doc.id][extraInfos[key].field]?.length">

            <!-- Ueberschrift links (z.B. "Schlagwoerter") -->
            <label class="font-weight-bold text-right mr-2">{{extraInfos[key].label}}</label>

            <!-- Wenn es ein Einzeltwert ist, Wert ausgeben und mit innerHTML binden, damit auch HTML (z.B. <a>) moeglich ist -->
            <span class="col"
                  *ngIf="getType((detailedView$ | async)[doc.id][extraInfos[key].field]) === 'single'"
                  appDisplayLink [value]="(detailedView$ | async)[doc.id][extraInfos[key].field]"
                  [display]="extraInfos[key].display">
                    </span>

            <!-- Wenn es ein Multiwert ist -->
            <span class="col"
                  *ngIf="getType((detailedView$ | async)[doc.id][extraInfos[key].field]) === 'multi'">

                      <!-- Ueber Werte (z.B. einzelne Schlagwoerter) gehen -->
                      <ng-container
                        *ngFor="let value of (detailedView$ | async)[doc.id][extraInfos[key].field]; last as isLast;">

                        <!-- Wert ausgeben, mit innerHTML binden, damit auch HTML (z.B. <a>) moeglich ist -->
                        <span appDisplayLink [value]="value" [display]="extraInfos[key].display"></span>

                        <!-- Zeilenumbruch, wenn nicht der letzte Wert -->
                        <br *ngIf="!isLast">
                      </ng-container>
                    </span>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
